---
title: 色彩取樣
description: 影像記錄顏色的資料布局
authors: yhchen
tags: 
  - streaming
date: 2025-12-10T15:51:01
---

RGB 與 YUV420 是影像資料最常見的 Pixel Format。RGB 每個像素具備完整三通道；YUV420 則把影像拆成亮度與色度，並以 4:2:0 子取樣降低色度解析度。這種設計能在維持視覺品質的前提下，減少至少一半以上影像資料量，是所有現代編碼器與串流協定的基礎。

<!-- truncate -->

## Pixel Format

Pixel Format 指影像在記憶體中的具體編碼方式，包括通道組成、位元深度與資料排列順序。RGB 直接記錄紅、綠、藍三通道強度，因此資訊完整但容量大。YUV 類格式（更精確為 YCbCr）則將影像拆成亮度 Y 和兩個色度 Cb、Cr，為後續的子取樣與壓縮奠定結構。

### RGB

每個像素包含三個通道：R、G、B。在大多數格式裡，三個值的位深一致（例如各 8 bit）。結構上，RGB 直接描述紅、綠、藍的組成，因此：

- 適合顯示器與 GPU 處理。
- 空間大（每像素 3 bytes 或更多）。
- 不直接節省頻寬。

### YUV (YCbCr)

YUV 將影像拆成亮度與色度後，可依需求調整色度解析度。常見的取樣方式是 4:2:0

- 第一個數字 4：寬度方向的基底取樣單位
- 第二個數字 2：色度水平方向縮半
- 第三個數字 0：色度垂直方向也縮半（與亮度相比）

為節省頻寬，大多數YUV格式使用的每 pixel bits 都少於24位元。YUV在對相片或影片編碼時，考慮到人類的感知能力，允許降低色度的頻寬(因為人類對亮度比較敏感)。

---

| ![Pixel_fmt](images/20251210T155101539-1765382511396.png) |
| :-------------------------------------------------------: |
|         使用 `ffmpeg -pix_fmts` 列出Pixel Format          |

### 4:2:0 與 4:2:2

4:2:0 的重點在於降低色度解析度。亮度維持逐像素一筆，色度水平與垂直都縮為原本的一半，使色度資料僅佔亮度的四分之一。以 1920×1080 影像為例，Y 是完整 1920×1080，而 Cb/Cr 只有 960×540。這種做法的視覺損失較小，卻能降低大量資料量。

4:2:2 保留較高的色度密度，色度在水平方向縮半，但垂直方向與亮度一致。以 1920×1080 為例，Cb/Cr 變為 960×1080。相較 4:2:0，它提供更穩定的色彩邊緣與較少色階破裂，但資料量增加約 1.5 倍。此格式常見於廣播、攝影機錄製與需要高色彩精度的製作流程。

## Planar 與 Packed

通常會用來表示色彩取樣的資料如何被存放在記憶體

- Planar : 每個通道分開
- Packed : 三個成分放在一起

如果使用 1 &times; N 與 RGB格式來描述兩種儲存方法：

```json
// Planar 格式
[
  [R1, R2, R3, R4, ...RN],
  [G1, G2, G3, G4, ...GN],
  [B1, B2, B3, B4, ...BN],
]
```

```json
// Packed 格式
[ [R1,G1,B1],[R2,G2,B2],[R3,G3,B3], ...[RN,GN,BN] ]
```

Planar 的概念並不限定通道長度一致，RGB 的由於 R、G、B 三個資料的大小相同，Planar 看起來會等長的，但是換算到 YUV420P 的情況：

```json
// Planar
[
  [52, 55, 61, 66],
  [128],
  [128]
]

// Packed
[ [52, 55, 61, 66, 128, 128]... ]
```

因為 Cb 與 Cr 的分量是 Y 的四分之一( Weight \* 0.5, Height \* 0.5)，所以看起來不會像 RGB 那樣三個通道的長度是等長的。

Planar 在記憶體裡會是三段或更多段獨立的平面：`YYYY... ,CbCb... ,CrCr...`

亮度、色度資料在邏輯上完全分離。這導致亮度與色度可以獨立處理，且同一通道連續排列，使濾波、縮放、捲積等計算更好向量化。這也是編碼器預期的輸入格式

Packed 把每個像素的成分擺在一起：`YCbYCr, YCbYCr, YCbYCr ...`

這針對單一像速處理的算法很簡單，因為直接取出下一個區段的資料就好，不必訪問其他通道的資料。但不利於編碼器處理，因為壓縮算法完全不同，且不好進行向量化。
